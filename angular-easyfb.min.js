/*! angular-easyfb
version: 0.2.2
build date: 2014-01-01
author: Robin Fan
https://github.com/pc035860/angular-easyfb.git */
angular.module("ezfb",[]).provider("$FB",function(){function a(b,c){if(0!==c.length){var d=c.shift();b[d]||(b[d]={}),a(b,c)}}function b(a,b){return angular.isObject(b)?(angular.extend(a,b),void 0):angular.copy(a)}function c(a,b,c){return function(){return a.apply(b,c)}}var d=-1,e={api:[1,2,3],ui:1,getLoginStatus:0,login:0,logout:0,"Event.subscribe":1,"Event.unsubscribe":1,"XFBML.parse":d,"Canvas.Prefetcher.addStaticResource":d,"Canvas.Prefetcher.setCollectionMode":d,"Canvas.hideFlashElement":d,"Canvas.scrollTo":d,"Canvas.setAutoGrow":d,"Canvas.setDoneLoading":0,"Canvas.setSize":d,"Canvas.setUrlHandler":0,"Canvas.showFlashElement":d,"Canvas.startTimer":d,"Canvas.stopTimer":0},f="en_US",g={status:!0,cookie:!0,xfbml:!0},h=["$window","$fbInitParams",function(a,b){a.FB.init(b)}],i=h;return{setInitParams:function(a){b(g,a)},getInitParams:function(){return b(g)},setLocale:function(a){f=a},getLocale:function(){return f},setInitFunction:function(a){if(!angular.isArray(a)&&!angular.isFunction(a))throw new Error("Init function type error.");i=a},getInitFunction:function(){return i},$get:["$window","$q","$document","$parse","$rootScope","$injector",function(j,k,l,m,n,o){var p,q,r={},s=k.defer();return(g.appId||i!==h)&&s.resolve(),l[0].getElementById("fb-root")||l.find("body").append('<div id="fb-root"></div>'),p=k.defer(),function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/"+f+"/all.js",d.parentNode.insertBefore(b,d))}(l[0]),j.fbAsyncInit=function(){s.promise.then(function(){o.invoke(i,null,{$fbInitParams:g}),q.$$ready=!0,p.resolve()})},q={$$ready:!1,init:function(a){b(g,a),s.resolve()}},angular.forEach(e,function(b,e){a(q,e.split(/\./));var f=m(e),g=f.assign;g(q,function(){var a=Array.prototype.slice.call(arguments),g=c(function(a){var c=k.defer(),g=function(b){for(var d=angular.isFunction(a[b])?a[b]:angular.noop,f=function(){var a=Array.prototype.slice.call(arguments);n.$$phase?(d.apply(null,a),c.resolve.apply(c,a)):n.$apply(function(){d.apply(null,a),c.resolve.apply(c,a)})};a.length<=b;)a.push(null);var g;if("Event.subscribe"===e)g=a[0],angular.isUndefined(r[g])&&(r[g]=[]),r[g].push({original:d,wrapped:f});else if("Event.unsubscribe"===e&&(g=a[0],angular.isArray(r[g]))){var h,i,j=r[g].length;for(h=0;j>h;h++)if(i=r[g][h],i.original===d){f=i.wrapped,r[g].splice(h,1);break}}a[b]=f};if(b!==d)if(angular.isNumber(b))g(b);else if(angular.isArray(b)){var h,i;for(h=0;h<b.length;h++)if(i=b[h],a.length==i||a.length==i+1&&angular.isFunction(a[i])){g(i);break}}var l=f(j.FB);if(!l)throw new Error("Facebook API `FB."+e+"` doesn't exist.");return l.apply(j.FB,a),c.promise},null,[a]);return b!==d?p.promise.then(g):(p.promise.then(g),void 0)})}),q}]}}).directive("ezfbXfbml",["$FB","$parse","$compile","$timeout",function(a,b,c,d){return{restrict:"EAC",compile:function(e){var f=e.html();return function(e,g,h){var i=!0,j=h.onrender||"",k=function(){i&&(e.$eval(j),i=!1)},l="xfbml.render";j&&(a.Event.subscribe(l,k),g.bind("$destroy",function(){a.Event.unsubscribe(l,k),g.unbind("$destroy")})),a.XFBML.parse(g[0]);var m=b(h.ezfbXfbml).assign;e.$watch(h.ezfbXfbml,function(b){b&&(i=!0,g.html(f),c(g.contents())(e),d(function(){a.XFBML.parse(g[0])}),(m||angular.noop)(e,!1))},!0)}}}}]);